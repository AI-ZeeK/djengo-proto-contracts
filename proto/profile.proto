syntax = "proto3";

import "google/protobuf/struct.proto";

package profile;


// üë§ Profile Service - handles user profiles and user management
service ProfileService {
  // user services
  rpc ValidateAccount(ValidateAccountRequest) returns (ValidateAccountResponse);
  rpc Register(RegisterRequest) returns (AuthInitialResponse);
  rpc Login(LoginRequest) returns (AuthInitialResponse);
  rpc SendOtp(SendOtpRequest) returns (SendOtpResponse);
  rpc VerifyOtp(VerifyOtpRequest) returns (VerifyOtpResponse);
  rpc Logout(LogoutRequest) returns (SendOtpResponse);
  rpc RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse);

  rpc GetRoles(EmptyRequest) returns (GetRolesResponse);
  
  // User Management
  rpc GetUser(GetUserRequest) returns (UserResponse);
  rpc GetBusinessUser(GetUserRequest) returns (BusinessUserResponse);
  rpc GetUserByEmail(GetUserByEmailRequest) returns (GetUserByEmailResponse);
  rpc UpdateUserStatus(UpdateUserStatusRequest) returns (UpdateUserStatusResponse);
  rpc GetUserContacts(GetUserContactsRequest) returns (GetUserContactsResponse);
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);

  // BUSINESS ROLES
  rpc CreateOrUpdateBusinessUserRole(CreateOrUpdateBusinessUserRoleRequest) returns (CreateOrUpdateBusinessUserRoleResponse);

  rpc FetchOrganizationRoles(OrganizationRoleIdRequest) returns (FetchOrganizationRolesResponse);
  rpc FetchOrganizationRolesCount(OrganizationRoleIdRequest) returns (FetchOrganizationRolesCountResponse);

  rpc getStaffDetails(StaffDetailsRequest) returns (StaffDetailsResponse);
  rpc getManyStaffDetails(ManyStaffDetailsRequest) returns (ManyStaffDetailsResponse);
  
  
  rpc AdminGetUsers(GetUsersRequest) returns (GetUsersResponse); 
  rpc AdminUsersAnalytics(AdminUsersAnalyticsRequest) returns (AdminUsersAnalyticsResponse);
}

enum TIMELINE_ENUM {
  _1m = 0;
  _3m = 1;
  _6m = 2;
  _1y = 3;

}


message AdminUsersAnalyticsRequest {
  optional TIMELINE_ENUM timeline = 1;
  optional string start_date = 2;
  optional string end_date = 3;
  optional string role_slug = 4;
}

message Analytic {
  int32 value = 1;
  string trend = 2;
  string percentage = 3;
  
}

message AdminUsersAnalyticsResponse {
  Analytic total_users = 1;
  Analytic new_users = 2;
  Analytic active_users = 3;
  Analytic business_users = 4;
  Analytic pending_users = 5;
  Analytic deactivated_users = 6;
  Analytic high_value_users = 7;
  Analytic at_risk_users = 8;
}

message GetUsersRequest {
  string search = 1;
  int32 page = 2;
  int32 page_size = 3;
  string sort_by = 4;
  string sort_order = 5;
}

message TableMeta {
  int32 total = 1;
  int32 current_page = 2;
  int32 page_size = 3;
  int32 total_pages = 4;
  int32 next_page = 5;
  int32 prev_page = 6;

}

message GetUsersResponse {
  bool success = 1;
  optional string error = 2;
  repeated User users = 3;
  TableMeta meta = 4;
}


message StaffDetailsRequest {
  string staff_id = 1;  
  string company_id = 2;
}
message ManyStaffDetailsRequest {
  repeated string staff_ids = 1;  
  string company_id = 2;
}

message Staff {
  string staff_id = 1;
  string company_id = 2;
  string user_id = 3;
  optional string branch_id = 4;
  string email = 5;
  optional string designation = 6;
  bool is_active = 7;
  string created_at = 10;
  string updated_at = 11;
}

message StaffDetailsResponse {
  bool success = 1;
  optional string error = 2;
  optional Staff staff = 3;
}
message ManyStaffDetailsResponse {
  bool success = 1;
  optional string error = 2;
  repeated Staff staffs = 3;
}

message ValidateAccountRequest {
  string token = 1;
}

message ValidateAccountResponse {
  User user = 1;
  bool success = 2;
  string message = 3;
}


message OrganizationRoleIdRequest {
  string organization_role_id = 1;
}

message FetchOrganizationRolesResponse {
  repeated Role roles = 1;
}

message FetchOrganizationRolesCountResponse {
  int32 count = 1;
}


message CommonResponseArray {
  bool success = 1;
  string message = 2;
  int32 status = 3;
  repeated google.protobuf.Struct data = 4;
  repeated Role roles = 5;
}


// üìù REQUEST MESSAGES

message EmptyRequest {}

message CreateOrUpdateBusinessUserRoleRequest {
  repeated string business_user_ids = 1;
  string organization_role_id = 2;
}



message CreateOrUpdateBusinessUserRoleResponse {
  bool success = 1;
  optional string error = 2;
  optional string message = 3;
}

message Role {
  string role_id = 1;
  string role_name = 2;
  bool is_active = 3;
}

message BusinessUserRole {
  string business_user_role_id = 1;
  string business_user_id = 2;
  string organization_role_id = 3;
  bool is_active = 4;
}

message GetRolesResponse {
  repeated Role roles = 1;
}

message VerifyOtpResponse {
  bool success = 1;
  optional string error = 2;
  optional string message = 3;
  optional string access_token = 4;
  optional User user = 5;
}

enum SessionSource {
  WEB = 0;
  MOBILE = 1;
  TABLET = 2;
  OTHER = 3;
}

message LoginRequest {
  string email = 1;
  string password = 2;

}

message SendOtpRequest {
  string token = 1;
  SendOtpType type = 2;
}

message VerifyOtpRequest {
  string token = 1;
  string otp = 2;
  SendOtpType type = 3;
  string device_info = 4;
  SessionSource source = 5;
}

message SendOtpResponse {
  bool success = 1;
  optional string error = 2;
  optional string message = 3;
}

message RefreshTokenResponse {
  bool success = 1;
  User user = 2;
  string access_token = 3;
}



message AuthResponse {
  bool success = 1;
  optional string error = 2;
  User user = 3;
  string access_token = 4;
}
message AuthInitialResponse {
  bool success = 1;
  optional string error = 2;
  optional string message = 3;
  optional string auth_token = 4;
}
  


message RegisterRequest {
  string email = 1;
  string password = 2;
  string phone_number = 3;
  string company_ref = 4;
  string role_name = 5;

}


enum ROLES_ENUM {
  CLIENT = 0;
  BUSINESS_USER = 1;
  STAFF = 2;
}

message LogoutRequest {
  string user_id = 1;
  SessionSource source = 2;
}

message RefreshTokenRequest {
  string token = 1;
}



message GetUserRequest {
  string user_id = 1;
}

message GetUserByEmailRequest {
  string email = 1;
}

message UpdateUserStatusRequest {
  string user_id = 1;
  string last_seen = 2;
}

message GetUserContactsRequest {
  string user_id = 1;
  optional string name = 2;
}

message UpdateUserRequest {
  string user_id = 1;
  optional string first_name = 2;
  optional string last_name = 3;
  optional string email = 4;
  optional string phone_number = 5;
  optional string avatar_url = 6;
  optional Address address = 7;
  optional string country_code = 8;
}

// üì§ RESPONSE MESSAGES

message BusinessUser {
  string business_user_id = 1;
  string user_id = 2;
  string email = 3;
  string phone_number = 4;
  string organization_id = 5;
  string access_type = 6;
  int32 access_level = 7;
  bool is_active = 8;
  optional string notes = 9;
}

message BusinessUserResponse {
  bool success = 1;
  optional string error = 2;
  optional BusinessUser business_user = 3;
  optional Organization organization = 4;
  optional Company company = 5;
}

message UserResponse {
  bool success = 1;
  optional string error = 2;
  optional User user = 3;
}

message GetUserByEmailResponse {
  bool success = 1;
  optional string error = 2;
  optional string message = 3;
  optional User user = 4;
}

message UpdateUserStatusResponse {
  bool success = 1;
  optional string error = 2;
  optional User user = 3;
}

message GetUserContactsResponse {
  bool success = 1;
  optional string error = 2;
  repeated Contact contacts = 3;
  int32 total_count = 4;
}

message UpdateUserResponse {
  bool success = 1;
  optional string error = 2;
  optional User user = 3;
}

// üèóÔ∏è DATA MODELS

message User {
  string user_id = 1;
  string email = 2;
  optional string username = 3;
  optional string first_name = 4;
  optional string last_name = 5;
  optional string phone_number = 6;
  optional string avatar_url = 7;
  optional string last_seen = 8;
  string created_at = 9;
  string updated_at = 10;
  string last_login = 11;
  bool email_verified = 12;
  optional Address address = 13;
  optional UserRole user_role = 14;
  repeated UserRole user_roles = 15;
  optional BusinessUser business_user = 16;
}

// message BasicUser {
//   string user_id = 1;
//   string email = 2;
//   optional string username = 3;
//   optional string first_name = 4;
//   optional string last_name = 5;
//   optional string phone_number = 6;
//   optional string last_seen = 7;
//   string created_at = 8;
//   string updated_at = 9;
//   bool email_verified = 10;
// }

message Contact {
  string user_id = 1;
  string email = 2;
  optional string username = 3;
  optional string first_name = 4;
  optional string last_name = 5;
  optional string avatar_url = 6;
  optional string last_seen = 7;
  bool email_verified = 8;
}

message Organization {
  string organization_id = 1;
  string name = 2;
  string phone_number = 3;
  string email = 4;
  string registration_number = 5;
  string registration_date = 6;
  bool is_active = 7;
  bool is_multi_company = 8;
  string creator_id = 9;
  string created_at = 10;
  string updated_at = 11;
  optional string deleted_at = 12;
}

message Address {
  optional string address_id = 1;
  optional string street = 2;
  optional string building = 3;
  optional string apartment = 4;
  optional string district = 5;
  optional string city = 6;
  optional string state = 7;
  optional string postal_code = 8;
  optional string country = 9;
  optional string landmark = 10;
  optional string direction_url = 11;
  optional double latitude = 12;
  optional double longitude = 13;
}

message UserRole {
  string user_id = 1;
  string role_name = 2;
  bool is_active = 3;
 Role role = 4;
}



enum SendOtpType {
  REGISTRATION = 0;
  SIGNIN = 1;
  ADMIN_REGISTRATION = 2;
  ADMIN_SIGNIN = 3;
  FORGOT_PASSWORD = 4;
}
message Company {
  string company_id = 1;
  string organization_id = 2;
  string reference_id = 3;
  string email = 4;
  string name = 5;
  string registration_date = 6;
  bool is_active = 7;
  string registration_number = 8;
  string created_at = 9;
  string updated_at = 10;
  optional string deleted_at = 11;  
  CompanyMetaData company_meta_data = 12;
  repeated Branch branches = 13;
}


message CompanyMetaData {
  string company_id = 1;
  string staff_count = 2;
  string branch_count = 3;
  bool is_multi_branch = 4;

}

message Branch {
  string branch_id = 1;
  string company_id = 2;
  string name = 3;
  string email = 4;
  string phone_number = 5;
  AddressRequest address = 6;
  bool is_main_branch = 7;
  bool is_active = 8;
  string created_at = 9;
  string updated_at = 10;
  optional string deleted_at = 11;
  optional string creator_id = 12;
}
message AddressRequest {
  optional string address_id = 1;
  optional string street = 2;
  optional string building = 3;
  optional string apartment = 4;
  optional string district = 5;
  optional string city = 6;
  optional string state = 7;
  optional string postal_code = 8;
  optional string country = 9;
  optional string landmark = 10;
  optional string direction_url = 11;
  optional double latitude = 12;
  optional double longitude = 13;
}
  
