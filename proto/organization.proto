syntax = "proto3";

package organization;

// üè¢ Organization Service - handles organization and branch management
service OrganizationService {
  // Organization Management
  rpc CreateOrganization(CreateOrganizationRequest) returns (OrganizationResponse);
  rpc GetOrganization(GetOrganizationRequest) returns (OrganizationResponse);

  // Validate Company Reference
  rpc ValidateCompanyReference(ValidateCompanyReferenceRequest) returns (ValidateCompanyReferenceResponse);
  
  // Verify IDs
  rpc VerifyCompanyId(VerifyCompanyIdRequest) returns (VerifyCompanyIdResponse);
  rpc VerifyBranchId(VerifyBranchIdRequest) returns (VerifyBranchIdResponse);
  rpc VerifyDepartmentId(VerifyDepartmentIdRequest) returns (VerifyDepartmentIdResponse);
  rpc VerifyRoleId(VerifyRoleIdRequest) returns (VerifyRoleIdResponse);

  // Create Company
  rpc CreateCompany(CreateCompanyRequest) returns (UtilitiesResponse);
  rpc FetchOrganizationCompanies(OrganizationIdRequest) returns (FetchCompaniesResponse);
  rpc FetchCompany(FetchCompanyRequest) returns (FetchCompanyResponse);
  rpc HandleMultiBranchCompanySetup(FetchCompanyRequest) returns (UtilitiesResponse);
  rpc UpdateCompanyDetails(UpdateCompanyDetailsRequest) returns (UtilitiesResponse);
  // Create Branch
  // rpc CreateBranch(CreateBranchRequest) returns (UtilitiesResponse);
  rpc FetchBranch(BranchIdRequest) returns (FetchBranchResponse);
  rpc FetchCompanyBranches(FetchCompanyRequest) returns (FetchBranchesResponse);
  // rpc UpdateBranch(UpdateBranchRequest) returns (UtilitiesResponse);
  // rpc DeleteBranch(BranchIdRequest) returns (UtilitiesResponse);



  // Utilities



  rpc FetchOrgRoles(OrganizationIdRequest) returns (FetchRolesResponse);
  rpc FetchOrgRole(OrganizationRoleIdRequest) returns (FetchRoleResponse);
  rpc CreateBusinessUserRole(CreateBusinessUserRoleRequest) returns (UtilitiesResponse);
  rpc UpdateBusinessUserRole(CreateBusinessUserRoleRequest) returns (UtilitiesResponse);

  rpc CreateRole(CreateRoleRequest) returns (UtilitiesResponse);
  rpc UpdateRole(UpdateRoleRequest) returns (UtilitiesResponse);
  rpc GetCompanyRoles(CompanyRolesRequest) returns (FetchRolesResponse);
  rpc GetCompanyRole(CompanyRoleRequest) returns (FetchRoleResponse);

  // Analytics
  rpc GetOrganizationAnalytics(OrganizationAnalyticsRequest) returns (OrganizationAnalyticsResponse);
  rpc TotalOrganizations(EmptyRequest) returns (TotalOrganizationsResponse);
  rpc TopPerformingOrganizations(TopPerformingOrganizationsRequest) returns (TopPerformingOrganizationsResponse);
  
  // Tables
  rpc GetOrganizations(GetOrganizationsRequest) returns (GetOrganizationsResponse);
}

message CompanyRoleRequest {
  string company_id = 1;
  string role_id = 2;
}
message CompanyRolesRequest {
  string company_id = 1;
  optional string branch_id = 2;
  RoleType role_type = 3;
}

message UpdateCompanyDetailsRequest {
  string company_id = 1;
  string name = 2;
  string phone_number = 3;
  string email = 4; 
  string registration_number = 5;
  string registration_date = 6;
  string country_code = 7;
  string company_logo = 8;
  string base_currency = 9;
  optional AddressRequest address = 10;
}

message OrganizationRoleIdRequest {
  string organization_role_slug = 1;
  string organization_id = 2;
}



message FetchCompanyRequest {
  string company_id = 1;
}


message FetchCompanyResponse {    
  bool success = 1;
  optional string error = 2;
  Company company = 3;
  string message = 4;
}
message FetchBranchResponse {    
  bool success = 1;
  optional string error = 2;
  Branch branch = 3;
  string message = 4;
}
message FetchBranchesResponse {      
  bool success = 1;
  optional string error = 2;
  repeated Branch branches = 3;
  string message = 4;
}


message FetchRolesResponse {
  bool success = 1;
  optional string error = 2;
  repeated OrganizationRole organization_roles = 3;
}

message FetchRoleResponse {
  bool success = 1;
  optional string error = 2;
  OrganizationRole organization_role = 3;
} 

message RoleData {
  OrganizationRole organization_role = 3;
}


message CreateBusinessUserRoleRequest {
  string organization_id = 1;
  string role_name = 2;
  string description = 3;
  repeated string business_user_ids = 4;
  repeated Permission permissions = 5;
  string creator_id = 6;
}
enum RoleType {
  STAFF_ROLE = 0;
  BUSINESS_USER_ROLE = 1;
}
message CreateRoleRequest {
  string company_id = 1;
  string role_name = 2;
  string description = 3;
  repeated string staff_ids = 4;
  repeated string business_user_ids = 5;
  repeated Permission permissions = 6;
  string creator_id = 7;
  RoleType role_type = 8;
  optional string branch_id = 9;
}
message UpdateRoleRequest {
  string role_id = 1;
  string company_id = 2;
  string role_name = 3;
  string description = 4;
  repeated string staff_ids = 5;
  repeated string business_user_ids = 6;
  repeated Permission permissions = 7;
  string creator_id = 8;
  RoleType role_type = 9;
  optional string branch_id = 10;
}

message Permission {
  string permission_name = 1;
  bool state = 2;
}

// üìù REQUEST MESSAGES

message EmptyRequest {
}


message BranchIdRequest {
  string branch_id = 1;
}

message OrganizationIdRequest {
  string organization_id = 1;
}

message ServiceType {
  int32 service_type_id = 1;
  string name = 2;
  string description = 3;
  bool is_active = 4;
}
// ÔøΩ RESPONSE MESSAGES
message BusinessUserRole {
  string business_user_id = 2;
  string organization_role_id = 3;
  bool is_active = 4;
  string _count = 5;
  string created_at = 6;
  string updated_at = 7;
  string deleted_at = 8;
}

message StaffCompanyRole {
  string staff_id = 2;
  string company_role_id = 3;
  bool is_active = 4;
  OrganizationRole company_role = 5;
}

message EntityPermission {
  string entity_id = 1;
  string entity_type = 2;
  string permission_id = 3;
  bool is_granted = 4;
  string granted_at = 5;
  string granted_by_user_id = 6;
  int32 level = 7;
  PermissionResponse permission = 8;
}

  message PermissionResponse {
  string permission_id = 1;
  string permission_name = 2;
  string description = 3;
  int32 level = 4;
  string created_at = 5;
  string updated_at = 6;
}

message OrganizationRole {
  string role_id = 1;
  string organization_id = 2;
  string company_id = 3;
  string branch_id = 4;
  string name = 5;
  string slug = 6;
  string description = 7;
  bool is_active = 8;
  int32 business_user_roles_count = 9;
  bool is_org_level = 10;
  string created_at = 11;
  string updated_at = 12;
  string deleted_at = 13;
  repeated BusinessUserRole business_user_roles = 14;
  repeated StaffCompanyRole staff_company_roles = 15;
  repeated EntityPermission entity_permissions = 16 ;
}


message UtilitiesResponse {
  bool success = 1;
  optional string error = 2;
  string message = 3;
}

message FetchCompaniesResponse {
  bool success = 1;
  optional string error = 2;
  repeated Company companies = 3;
}

message ValidateCompanyReferenceRequest {
  string company_ref = 1;
}

message ValidateCompanyReferenceResponse {
  bool success = 1;
  optional string error = 2;
  Company company = 3;
}

message VerifyCompanyIdRequest {
  string company_id = 1;
  string organization_id = 2;
}

message VerifyCompanyIdResponse {
  bool success = 1;
  optional string error = 2;
  string message = 3;
  optional Company company = 4;
}

message VerifyBranchIdRequest {
  string branch_id = 1;
  string company_id = 2;
  string organization_id = 3;
}

message VerifyBranchIdResponse {
  bool success = 1;
  optional string error = 2;
  string message = 3;
  optional Branch branch = 4;
}

message VerifyDepartmentIdRequest {
  string company_id = 1;
  string organization_id = 2;
  string department_id = 3;
}

message VerifyDepartmentIdResponse {
  bool success = 1;
  optional string error = 2;
  string message = 3;
  optional Department department = 4;
}

message VerifyRoleIdRequest {
  string company_id = 1;
  string role_id = 2;
}

message VerifyRoleIdResponse {
  bool success = 1;
  optional string error = 2;
  string message = 3;
  optional OrganizationRole role = 4;
}

message CreateCompanyRequest {
  string name = 1;
  string organization_id = 2;
  string creator_id = 3;
  string description = 4;
  string phone_number = 5;
  string email = 6;
  string registration_number = 7;
  string registration_date = 8;
  string company_logo = 9;
  bool is_multi_branch = 10;
  MainBranch main_branch = 11;
  // repeated BusinessType business_types = 12;
}

message MainBranch {
  optional string name = 1;
  optional string email = 2;
  optional string phone_number = 3;
  AddressRequest address = 4;
}

message AddressRequest {
  optional string address_id = 1;
  optional string street = 2;
  optional string building = 3;
  optional string apartment = 4;
  optional string district = 5;
  optional string city = 6;
  optional string state = 7;
  optional string postal_code = 8;
  optional string country = 9;
  optional string landmark = 10;
  optional string direction_url = 11;
  optional double latitude = 12;
  optional double longitude = 13;
}

message CreateOrganizationRequest {
  string creator_id = 1;
  string organization_name = 2;
  string phone_number = 3;
  string email = 4;
  string registration_number = 5;
  string registration_date = 6;
}

message GetOrganizationRequest {
  string organization_id = 1;
}

// üì§ RESPONSE MESSAGES

message OrganizationResponse {
  bool success = 1;
  optional string error = 2;
  Organization organization = 3;
  Company company = 4;
  string organization_id = 5;
  string message = 6;  
}
// üèóÔ∏è DATA MODELS
message Organization {
  string organization_id = 1;
  string name = 2;
  string phone_number = 3;
  string email = 4;
  string registration_number = 5;
  string registration_date = 6;
  bool is_active = 7;
  bool is_multi_company = 8;
  string creator_id = 9;
  string created_at = 10;
  string updated_at = 11;
  optional string deleted_at = 12;
}

message Company {
  string company_id = 1;
  string organization_id = 2;
  string reference_id = 3;
  string email = 4;
  string name = 5;
  string registration_date = 6;
  bool   is_active = 7;
  string registration_number = 8;
  string company_logo = 9;
  string base_currency = 10;
  string country_code = 11;
  string phone_number = 12;
  string created_at = 13;
  string updated_at = 14;
  optional string deleted_at = 15;
  CompanyMetaData company_meta_data = 16;
  Branch main_branch = 17;
  repeated Branch branches = 18;
}


message CompanyMetaData {
  string company_id = 1;
  string staff_count = 2;
  string branch_count = 3;
  bool is_multi_branch = 4;

}

message Branch {
  string branch_id = 1;
  string company_id = 2;
  string name = 3;
  string email = 4;
  string phone_number = 5;
  AddressRequest address = 6;
  bool is_main_branch = 7;
  bool is_active = 8;
  string created_at = 9;
  string updated_at = 10;
  optional string deleted_at = 11;
  optional string creator_id = 12;
}

message Department {
  string department_id = 1;
  string company_id = 2;
  optional string branch_id = 3;
  string name = 4;
  optional string description = 5;
  bool is_active = 6;
  string created_at = 7;
  string updated_at = 8;
  optional string deleted_at = 9;
}

// message Company {
//   string company_id = 1;
//   string name = 2;
//   string description = 3;
//   string phone_number = 4;
//   string email = 5; 
//   string registration_number = 6;
//   string registration_date = 7;
//   string company_logo = 8;
//   bool is_multi_branch = 9;
//   MainBranch main_branch = 10;
//   repeated BusinessType business_types = 11;
// }

// Analytics Messages
message TrendData {
  string name = 1;
  int32 value = 2;
}

message OrganizationAnalyticsRequest {
  string timeline = 1;
  optional string start_date = 2;
  optional string end_date = 3;
}

message OrganizationMetric {
  int32 count = 1;
  double percentage = 2;
  string trend = 3;
}

message OrganizationMetricWithTrend {
  int32 count = 1;
  double percentage = 2;
  string trend = 3;
  repeated TrendData trend_data = 4;
}

message TransactionMetric {
  int32 value = 1;
  double percentage = 2;
  string trend = 3;
}

message OrganizationAnalyticsResponse {
  OrganizationMetricWithTrend total_organizations = 1;
  OrganizationMetric active_organizations = 2;
  OrganizationMetric pending_organizations = 3;
  OrganizationMetric inactive_organizations = 4;
  OrganizationMetric high_revenue_organizations = 5;
  OrganizationMetric large_organizations = 6;
  TransactionMetric average_transactions = 7;
}

message TotalOrganizationsResponse {
  int32 count = 1;
  double percentage = 2;
  string trend = 3;
  repeated TrendData trend_data = 4;
}

message TopPerformingOrganizationsRequest {
  optional int32 limit = 1;
}

message OrganizationWithCounts {
  string organization_id = 1;
  string name = 2;
  string phone_number = 3;
  string email = 4;
  string registration_number = 5;
  string registration_date = 6;
  bool is_active = 7;
  bool is_multi_company = 8;
  string creator_id = 9;
  string created_at = 10;
  string updated_at = 11;
  optional string deleted_at = 12;
  int32 staff_count = 13;
  int32 business_user_count = 14;
  int32 access_control_count = 15;
  int32 companies_count = 16;
}

message TopPerformingOrganizationsResponse {
  repeated OrganizationWithCounts top_organizations = 1;
}

// Tables Messages
message GetOrganizationsRequest {
  optional string search = 1;
  optional int32 page = 2;
  optional int32 page_size = 3;
  optional string sort_by = 4;
  optional string sort_order = 5;
}

message OrganizationAddress {
  optional string street = 1;
  optional string building = 2;
  optional string apartment = 3;
  optional string city = 4;
  optional string state = 5;
  optional string country = 6;
  optional string postal_code = 7;
}

message OrganizationMeta {
  int32 organization_roles = 1;
  bool is_multi_company = 2;
  int32 companies_count = 3;
  int32 total_business_users = 4;
  int32 active_business_users = 5;
  int32 inactive_business_users = 6;
}

message OrganizationDetail {
  string organization_id = 1;
  string name = 2;
  string email = 3;
  optional string phone_number = 4;
  string status = 5;
  bool is_active = 6;
  bool email_verified = 7;
  bool phone_verified = 8;
  optional string registration_date = 9;
  string created_at = 10;
  string updated_at = 11;
  optional OrganizationAddress address = 12;
  OrganizationMeta meta = 13;
  int32 revenue = 14;
  int32 transactions = 15;
}

message PaginationMeta {
  int32 total = 1;
  int32 current_page = 2;
  int32 page_size = 3;
  int32 total_pages = 4;
  optional int32 next_page = 5;
  optional int32 prev_page = 6;
}

message GetOrganizationsResponse {
  repeated OrganizationDetail organizations = 1;
  PaginationMeta meta = 2;
}